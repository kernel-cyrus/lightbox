<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Intel Trusted Domain eXtension (TDX) &mdash; QEMU  documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/qemu_32x32.png"/>
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/custom.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Xtensa System emulator" href="../target-xtensa.html" />
    <link rel="prev" title="AMD Secure Encrypted Virtualization (SEV)" href="amd-memory-encryption.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #802400" >
            <a href="../../index.html" class="icon icon-home"> QEMU
            <img src="../../_static/qemu_128x128.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                10.0.50
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../about/index.html">About QEMU</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">System Emulation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../invocation.html">Invocation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../device-emulation.html">Device Emulation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../keys.html">Keys in the graphical frontends</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mux-chardev.html">Keys in the character backend multiplexer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../monitor.html">QEMU Monitor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../images.html">Disk Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="../virtio-net-failover.html">QEMU virtio-net standby (net_failover)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../linuxboot.html">Direct Linux Boot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../generic-loader.html">Generic Loader</a></li>
<li class="toctree-l2"><a class="reference internal" href="../guest-loader.html">Guest Loader</a></li>
<li class="toctree-l2"><a class="reference internal" href="../barrier.html">QEMU Barrier Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vnc-security.html">VNC security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tls.html">TLS setup for network services</a></li>
<li class="toctree-l2"><a class="reference internal" href="../secrets.html">Providing secret data to QEMU</a></li>
<li class="toctree-l2"><a class="reference internal" href="../authz.html">Client authorization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../gdb.html">GDB usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../replay.html">Record/replay</a></li>
<li class="toctree-l2"><a class="reference internal" href="../managed-startup.html">Managed start up options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bootindex.html">Managing device boot order with bootindex properties</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cpu-hotplug.html">Virtual CPU hotplug</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pr-manager.html">Persistent reservation managers</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../targets.html">QEMU System Emulator Targets</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../target-arm.html">Arm System emulator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../target-avr.html">AVR System emulator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../target-loongarch.html">LoongArch System emulator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../target-m68k.html">ColdFire System emulator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../target-mips.html">MIPS System emulator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../target-ppc.html">PowerPC System emulator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../target-openrisc.html">OpenRISC System emulator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../target-riscv.html">RISC-V System emulator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../target-rx.html">RX System emulator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../target-s390x.html">s390x System emulator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../target-sparc.html">Sparc32 System emulator</a></li>
<li class="toctree-l3"><a class="reference internal" href="../target-sparc64.html">Sparc64 System emulator</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../target-i386.html">x86 System emulator</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../target-i386.html#board-specific-documentation">Board-specific documentation</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="../target-i386.html#architectural-features">Architectural features</a></li>
<li class="toctree-l4"><a class="reference internal" href="../target-i386.html#os-requirements">OS requirements</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../target-xtensa.html">Xtensa System emulator</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../security.html">Security</a></li>
<li class="toctree-l2"><a class="reference internal" href="../multi-process.html">Multi-process QEMU</a></li>
<li class="toctree-l2"><a class="reference internal" href="../confidential-guest-support.html">Confidential Guest Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="../vm-templating.html">QEMU VM templating</a></li>
<li class="toctree-l2"><a class="reference internal" href="../sriov.html">Compsable SR-IOV device</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../user/index.html">User Mode Emulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tools/index.html">Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../interop/index.html">System Emulation Management and Interoperability</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../specs/index.html">System Emulation Guest Hardware Specifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devel/index.html">Developer Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #802400" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">QEMU</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">System Emulation</a> &raquo;</li>
          <li><a href="../targets.html">QEMU System Emulator Targets</a> &raquo;</li>
          <li><a href="../target-i386.html">x86 System emulator</a> &raquo;</li>
      <li>Intel Trusted Domain eXtension (TDX)</li>
      <li class="wy-breadcrumbs-aside">
            <a href="https://gitlab.com/qemu-project/qemu/-/blob/master/docs/system/i386/tdx.rst">View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="intel-trusted-domain-extension-tdx">
<h1>Intel Trusted Domain eXtension (TDX)<a class="headerlink" href="#intel-trusted-domain-extension-tdx" title="Permalink to this headline"></a></h1>
<p>Intel Trusted Domain eXtensions (TDX) refers to an Intel technology that extends
Virtual Machine Extensions (VMX) and Multi-Key Total Memory Encryption (MKTME)
with a new kind of virtual machine guest called a Trust Domain (TD). A TD runs
in a CPU mode that is designed to protect the confidentiality of its memory
contents and its CPU state from any other software, including the hosting
Virtual Machine Monitor (VMM), unless explicitly shared by the TD itself.</p>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline"></a></h2>
<p>To run TD, the physical machine needs to have TDX module loaded and initialized
while KVM hypervisor has TDX support and has TDX enabled. If those requirements
are met, the <code class="docutils literal notranslate"><span class="pre">KVM_CAP_VM_TYPES</span></code> will report the support of <code class="docutils literal notranslate"><span class="pre">KVM_X86_TDX_VM</span></code>.</p>
<section id="trust-domain-virtual-firmware-tdvf">
<h3>Trust Domain Virtual Firmware (TDVF)<a class="headerlink" href="#trust-domain-virtual-firmware-tdvf" title="Permalink to this headline"></a></h3>
<p>Trust Domain Virtual Firmware (TDVF) is required to provide TD services to boot
TD Guest OS. TDVF needs to be copied to guest private memory and measured before
the TD boots.</p>
<p>KVM vcpu ioctl <code class="docutils literal notranslate"><span class="pre">KVM_TDX_INIT_MEM_REGION</span></code> can be used to populate the TDVF
content into its private memory.</p>
<p>Since TDX doesn’t support readonly memslot, TDVF cannot be mapped as pflash
device and it actually works as RAM. “-bios” option is chosen to load TDVF.</p>
<p>OVMF is the opensource firmware that implements the TDVF support. Thus the
command line to specify and load TDVF is <code class="docutils literal notranslate"><span class="pre">-bios</span> <span class="pre">OVMF.fd</span></code></p>
</section>
</section>
<section id="feature-configuration">
<h2>Feature Configuration<a class="headerlink" href="#feature-configuration" title="Permalink to this headline"></a></h2>
<p>Unlike non-TDX VM, the CPU features (enumerated by CPU or MSR) of a TD are not
under full control of VMM. VMM can only configure part of features of a TD on
<code class="docutils literal notranslate"><span class="pre">KVM_TDX_INIT_VM</span></code> command of VM scope <code class="docutils literal notranslate"><span class="pre">MEMORY_ENCRYPT_OP</span></code> ioctl.</p>
<p>The configurable features have three types:</p>
<ul class="simple">
<li><p>Attributes:
- PKS (bit 30) controls whether Supervisor Protection Keys is exposed to TD,
which determines related CPUID bit and CR4 bit;
- PERFMON (bit 63) controls whether PMU is exposed to TD.</p></li>
<li><p>XSAVE related features (XFAM):
XFAM is a 64b mask, which has the same format as XCR0 or IA32_XSS MSR. It
determines the set of extended features available for use by the guest TD.</p></li>
<li><p>CPUID features:
Only some bits of some CPUID leaves are directly configurable by VMM.</p></li>
</ul>
<p>What features can be configured is reported via TDX capabilities.</p>
<section id="tdx-capabilities">
<h3>TDX capabilities<a class="headerlink" href="#tdx-capabilities" title="Permalink to this headline"></a></h3>
<p>The VM scope <code class="docutils literal notranslate"><span class="pre">MEMORY_ENCRYPT_OP</span></code> ioctl provides command <code class="docutils literal notranslate"><span class="pre">KVM_TDX_CAPABILITIES</span></code>
to get the TDX capabilities from KVM. It returns a data structure of
<code class="docutils literal notranslate"><span class="pre">struct</span> <span class="pre">kvm_tdx_capabilities</span></code>, which tells the supported configuration of
attributes, XFAM and CPUIDs.</p>
</section>
<section id="td-attributes">
<h3>TD attributes<a class="headerlink" href="#td-attributes" title="Permalink to this headline"></a></h3>
<p>QEMU supports configuring raw 64-bit TD attributes directly via “attributes”
property of “tdx-guest” object. Note, it’s users’ responsibility to provide a
valid value because some bits may not supported by current QEMU or KVM yet.</p>
<p>QEMU also supports the configuration of individual attribute bits that are
supported by it, via properties of “tdx-guest” object.
E.g., “sept-ve-disable” (bit 28).</p>
</section>
<section id="msr-based-features">
<h3>MSR based features<a class="headerlink" href="#msr-based-features" title="Permalink to this headline"></a></h3>
<p>Current KVM doesn’t support MSR based feature (e.g., MSR_IA32_ARCH_CAPABILITIES)
configuration for TDX, and it’s a future work to enable it in QEMU when KVM adds
support of it.</p>
</section>
<section id="feature-check">
<h3>Feature check<a class="headerlink" href="#feature-check" title="Permalink to this headline"></a></h3>
<p>QEMU checks if the final (CPU) features, determined by given cpu model and
explicit feature adjustment of “+featureA/-featureB”, can be supported or not.
It can produce feature not supported warning like</p>
<blockquote>
<div><p>“warning: host doesn’t support requested feature: CPUID.07H:EBX.intel-pt [bit 25]”</p>
</div></blockquote>
<p>It can also produce warning like</p>
<blockquote>
<div><p>“warning: TDX forcibly sets the feature: CPUID.80000007H:EDX.invtsc [bit 8]”</p>
</div></blockquote>
<p>if the fixed-1 feature is requested to be disabled explicitly. This is newly
added to QEMU for TDX because TDX has fixed-1 features that are forcibly enabled
by TDX module and VMM cannot disable them.</p>
</section>
</section>
<section id="launching-a-td-tdx-vm">
<h2>Launching a TD (TDX VM)<a class="headerlink" href="#launching-a-td-tdx-vm" title="Permalink to this headline"></a></h2>
<p>To launch a TD, the necessary command line options are tdx-guest object and
split kernel-irqchip, as below:</p>
<pre class="literal-block">qemu-system-x86_64 \
    -accel kvm \
    -cpu host \
    -object tdx-guest,id=tdx0 \
    -machine ...,confidential-guest-support=tdx0 \
    -bios OVMF.fd \</pre>
</section>
<section id="restrictions">
<h2>Restrictions<a class="headerlink" href="#restrictions" title="Permalink to this headline"></a></h2>
<blockquote>
<div><ul>
<li><p>kernel-irqchip must be split;</p>
<p>This is set by default for TDX guest if kernel-irqchip is left on its default
‘auto’ setting.</p>
</li>
<li><p>No readonly support for private memory;</p></li>
<li><p>No SMM support: SMM support requires manipulating the guest register states
which is not allowed;</p></li>
</ul>
</div></blockquote>
</section>
<section id="debugging">
<h2>Debugging<a class="headerlink" href="#debugging" title="Permalink to this headline"></a></h2>
<p>Bit 0 of TD attributes, is DEBUG bit, which decides if the TD runs in off-TD
debug mode. When in off-TD debug mode, TD’s VCPU state and private memory are
accessible via given SEAMCALLs. This requires KVM to expose APIs to invoke those
SEAMCALLs and corresonponding QEMU change.</p>
<p>It’s targeted as future work.</p>
</section>
<section id="td-attestation">
<h2>TD attestation<a class="headerlink" href="#td-attestation" title="Permalink to this headline"></a></h2>
<p>In TD guest, the attestation process is used to verify the TDX guest
trustworthiness to other entities before provisioning secrets to the guest.</p>
<p>TD attestation is initiated first by calling TDG.MR.REPORT inside TD to get the
REPORT. Then the REPORT data needs to be converted into a remotely verifiable
Quote by SGX Quoting Enclave (QE).</p>
<p>It’s a future work in QEMU to add support of TD attestation since it lacks
support in current KVM.</p>
</section>
<section id="live-migration">
<h2>Live Migration<a class="headerlink" href="#live-migration" title="Permalink to this headline"></a></h2>
<p>Future work.</p>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://www.intel.com/content/www/us/en/developer/articles/technical/intel-trust-domain-extensions.html">TDX Homepage</a></p></li>
<li><p><a class="reference external" href="https://github.com/intel/SGXDataCenterAttestationPrimitives/tree/master/QuoteGeneration">SGX QE</a></p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="amd-memory-encryption.html" class="btn btn-neutral float-left" title="AMD Secure Encrypted Virtualization (SEV)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../target-xtensa.html" class="btn btn-neutral float-right" title="Xtensa System emulator" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, The QEMU Project Developers.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
  

<!-- Empty para to force a blank line after "Built with Sphinx ..." -->
<p></p>

<p>This documentation is for QEMU version 10.0.50.</p>


<p><a href="../../about/license.html">QEMU and this manual are released under the
GNU General Public License, version 2.</a></p>

 


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>